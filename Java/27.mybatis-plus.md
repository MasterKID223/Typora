## mybatis-plus

### 基础用法

MyBatis-Plus（简称 MP）是一个基于 MyBatis 的增强工具，它简化了 MyBatis 的使用并提供了更多的功能。以下是 MyBatis-Plus 的基础用法：

1. **导入依赖**：

   首先，在你的项目中添加 MyBatis-Plus 的依赖，通常可以通过 Maven 或 Gradle 进行导入。

   ```xml
   <!-- Maven 依赖 -->
   <dependency>
       <groupId>com.baomidou</groupId>
       <artifactId>mybatis-plus</artifactId>
       <version>最新版本</version>
   </dependency>
   ```

2. **配置数据源和 MyBatis-Plus**：

   在 Spring Boot 项目中，你需要在配置文件（如 `application.properties` 或 `application.yml`）中配置数据源和 MyBatis-Plus 相关属性。下面是一个示例配置：

   ```yaml
   spring:
     datasource:
       url: jdbc:mysql://localhost:3306/mydb
       username: your_username
       password: your_password
       driver-class-name: com.mysql.cj.jdbc.Driver

   mybatis-plus:
     mapper-locations: classpath:mapper/*.xml
     global-config:
       db-config:
         id-type: auto
   ```

   这里配置了数据源的连接信息，指定了 MyBatis-Plus 的 Mapper 文件位置，并启用了主键自动生成策略（`id-type: auto`）。

3. **创建实体类**：

   创建与数据库表对应的实体类，通常使用注解来标记字段和表信息，如 `@TableName` 和 `@TableField`。

   ```java
   import com.baomidou.mybatisplus.annotation.TableName;
   import lombok.Data;

   @Data
   @TableName("user")
   public class User {
       private Long id;
       private String username;
       private String email;
   }
   ```

4. **创建 Mapper 接口**：

   创建一个继承自 `BaseMapper` 的接口，不需要编写实现类，MyBatis-Plus 会自动生成对应的 SQL 查询方法。

   ```java
   import com.baomidou.mybatisplus.core.mapper.BaseMapper;

   public interface UserMapper extends BaseMapper<User> {
   }
   ```

5. **使用 Mapper 进行数据库操作**：

   在业务逻辑中，通过注入 `UserMapper` 来使用 MyBatis-Plus 提供的数据访问方法。

   ```java
   @Service
   public class UserService {
       @Autowired
       private UserMapper userMapper;

       public User getUserById(Long id) {
           return userMapper.selectById(id);
       }

       public void createUser(User user) {
           userMapper.insert(user);
       }

       public void updateUser(User user) {
           userMapper.updateById(user);
       }

       public void deleteUser(Long id) {
           userMapper.deleteById(id);
       }
   }
   ```

6. **高级查询**：

   MyBatis-Plus 支持通过自定义条件构建器 `QueryWrapper` 来实现复杂的查询条件，例如：

   ```java
   QueryWrapper<User> wrapper = new QueryWrapper<>();
   wrapper.eq("username", "john")
          .like("email", "@example.com")
          .ge("id", 10)
          .orderByDesc("id");
   List<User> users = userMapper.selectList(wrapper);
   ```

7. **分页查询**：

   MyBatis-Plus 支持分页查询，可以使用 `Page` 对象来实现分页查询。

   ```java
   Page<User> page = new Page<>(1, 10); // 第一页，每页10条记录
   userMapper.selectPage(page, null);
   List<User> userList = page.getRecords();
   ```

这是 MyBatis-Plus 的基本用法概述。它提供了许多其他功能，如自定义查询方法、乐观锁支持、逻辑删除等。你可以根据项目需求深入学习和使用这些功能。同时，官方文档也提供了详细的使用说明和示例代码，可供参考。

### mapper.xml文件

`mapper.xml` 文件是 MyBatis 框架中用于配置 SQL 映射关系和具体 SQL 语句的文件。这些文件通常与 Java 的 Mapper 接口结合使用，用于定义如何将数据库操作与 Java 方法相对应。

一个典型的 `mapper.xml` 文件包含以下内容：

1. **命名空间（Namespace）**：定义了该 XML 文件与哪个 Java Mapper 接口相关联。

   ```xml
   <mapper namespace="com.example.mapper.UserMapper">
   ```

2. **SQL 映射**：在 `mapper.xml` 文件中，你可以定义各种 SQL 语句，包括查询、插入、更新和删除等。

   ```xml
   <select id="selectUserById" resultType="com.example.model.User">
       SELECT * FROM user WHERE id = #{id}
   </select>

   <insert id="insertUser" parameterType="com.example.model.User">
       INSERT INTO user (username, email) VALUES (#{username}, #{email})
   </insert>

   <update id="updateUser" parameterType="com.example.model.User">
       UPDATE user SET username = #{username}, email = #{email} WHERE id = #{id}
   </update>

   <delete id="deleteUser" parameterType="java.lang.Long">
       DELETE FROM user WHERE id = #{id}
   </delete>
   ```

3. **参数映射**：在 SQL 语句中，可以使用 `#{}` 占位符来引用方法参数或对象属性，MyBatis 会将这些占位符替换为实际的参数值。

4. **结果映射**：在查询语句中，可以使用 `resultType` 或 `resultMap` 来指定查询结果的映射类型，通常是一个 Java 对象，MyBatis 会将查询结果映射为这个对象的属性。

5. **参数映射**：在插入、更新和删除语句中，可以使用 `parameterType` 指定传递给 SQL 语句的参数类型。

6. **动态 SQL**：MyBatis 支持动态 SQL，你可以使用条件判断、循环等语句来构建动态的 SQL 查询，以根据不同的条件生成不同的 SQL 语句。

7. **SQL 片段**：你可以在 `mapper.xml` 中定义一些可重用的 SQL 片段，然后在不同的 SQL 语句中引用这些片段。

8. **其它配置**：除了 SQL 映射外，`mapper.xml` 文件还可以包含一些其它的配置，例如缓存配置、结果集映射规则、数据库连接池配置等。

总之，`mapper.xml` 文件是 MyBatis 中用于定义 SQL 映射和数据库操作的重要配置文件，它将 SQL 语句和 Java 方法关联起来，使开发人员能够轻松地执行数据库操作并将结果映射为 Java 对象。在 MyBatis 中，`mapper.xml` 文件通常与对应的 Mapper 接口一起使用，以提供数据库操作的实现细节。

### 分页查询

分页查询是一种数据库查询技术，用于从数据库表中检索数据的一部分，而不是检索整个数据集。这在处理大量数据或在Web应用程序中显示数据列表时非常有用。分页查询通常包括以下关键概念：

1. **页大小（Page Size）**：页大小指定每个查询结果页面中包含的数据行数。例如，如果页大小设置为10，那么每个页面将包含10行数据。

2. **当前页（Current Page）**：当前页表示用户当前查看的页码。用户可以通过界面进行切换。通常，第一页的页码是1。

3. **总记录数（Total Records）**：总记录数表示数据库表中满足查询条件的总数据行数。这是用来计算总页数的依据。

4. **总页数（Total Pages）**：总页数表示根据总记录数和页大小计算出来的总页码数量。

5. **起始索引和结束索引**：这是用于在数据库中截取数据的索引范围。通常，根据当前页和页大小，计算出起始索引和结束索引，然后从数据库中获取这个范围内的数据。

分页查询通常用于将大量数据划分成小块，以便于显示和导航。例如，在Web应用程序中，当用户查看产品列表、搜索结果、或者社交媒体的帖子时，通常会使用分页查询来限制每次加载的数据量，以确保页面加载速度快，并减轻服务器和数据库的负载。

分页查询也可以与排序一起使用，以便用户能够根据某些条件对数据进行排序，并在不同页面之间保持一致的排序顺序。

在SQL中，通常使用`LIMIT`和`OFFSET`（或类似的关键字，具体取决于数据库系统）来执行分页查询。这些关键字用于指定从查询结果中获取的行的范围。例如，`LIMIT 10 OFFSET 20`表示获取从第21行到第30行的数据。

分页查询对于提高用户体验和优化数据库性能都非常重要，因为它允许在处理大量数据时有效地管理和检索数据。

#### PaginationInnerInterceptor

`PaginationInnerInterceptor` 是一个类，通常与 MyBatis Plus（一种基于 MyBatis 的持久层框架）一起使用。它是 MyBatis Plus 提供的一个内部分页拦截器，用于处理分页查询。

这个拦截器的主要作用是在执行数据库查询时，自动添加分页相关的 SQL 语句（如 LIMIT、OFFSET）以实现分页功能，而无需手动编写这些 SQL 语句。这可以大大简化分页查询的代码编写，并提高代码的可维护性。

通常，你可以在 MyBatis Plus 的配置文件中配置 `PaginationInnerInterceptor`，并将它添加到 MyBatis 的拦截器链中。这样，当你执行带有分页条件的查询时，`PaginationInnerInterceptor` 会自动处理分页逻辑。

以下是一个示例配置 `PaginationInnerInterceptor` 的代码片段：

```java
import com.baomidou.mybatisplus.extension.plugins.PaginationInnerInterceptor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class MyBatisPlusConfig {

    @Bean
    public PaginationInnerInterceptor paginationInnerInterceptor() {
        return new PaginationInnerInterceptor();
    }
}
```

上述代码中，我们将 `PaginationInnerInterceptor` 注册为一个 Spring Bean，并在配置中使用它。你可以根据具体的项目需求进行配置，例如设置分页参数的命名规则、启用 count SQL 优化等。

总之，`PaginationInnerInterceptor` 是 MyBatis Plus 提供的一个用于简化分页查询的重要组件，它可以帮助你轻松实现数据库查询的分页功能。