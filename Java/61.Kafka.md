## Kafka

### 基本概念

Kafka的基本概念：Broker、Topic、Partition、副本Replication、副本类型Leader/Follower。Zookeeper的作用。

- 可以用数据库分库分表的逻辑理解上面的概念。当查询/写入请求并发太大时，一台机器的网络IO和CPU处理不过来，这时要多加机器，把请求分发到不同的机子上，避免太多请求把数据库打挂（数据分库），在Kafka上就是创建多个Broker分流Producer的写入请求和Consumer的查询请求。

- Kafka是发布-订阅模式，分布式消息系统的常用架构，如果有了解机器人的ROS系统，那么这个就比较好理解。依然类比数据库的概念，所有数据写入一张表（Topic），表太大时需要分表，在Kafka中就是创建多个Partition，把一个Topic中的数据均匀的分散到每个Partition上。但是，注意：一个Broker上的某一Topic只能有一个对应的Partition（仅指Leader写入，和副本管理区别开），这点和数据库中的概念不一样。

- 副本Replication指的是Partition的备份，别因为Broker宕机数据丢了。每个Partition的副本数量可以自己设置，但不超过Broker的数量。Patition的Leader副本（只有Leader能写入）和Follower副本不在一个Broker上，要不然Broker宕机副本也丢了。

- Zookeeper帮助Kafka实现Broker的主从架构。在Kafka集群中，要选定一个Broker当主节点（Controller节点），这里涉及到Controller选举算法（八股）。

- 主Broker的作用是：①发挥主从架构中的Master节点的作用，监听Broker的增减；②管理Topic，新增/更新/删除Topic；②管理Partition，分区重新分配（负载均衡）；③副本管理，通知副本同步情况、副本的Leader选举、副本分布在哪个Broker上。
