## 分库分表

### 读写分离

一主（写读）多从（读）

### 如何实现读写分离？

代理方式、组件方式（sharding-jdbc）

### 主从复制的原理

从数据库复制主数据库的binlog

### 如何避免主从延迟？

直接从主库里读（某些业务必须要求最新的数据）、延迟读取（用的少）

### 什么情况下会出现主从延迟？如何尽量减少延迟？

原因：主库更新binlog快从库接受慢，从库sql写快relaylog更新慢。

从库机器性能比主库差

从库处理的读请求过多

大事务

从库太多

网络延迟

单线程复制

复制模式（异步、同步、半同步）

### 分库分表

要解决的问题：如果 MySQL 一张表的数据量过大怎么办?我们该如何解决 MySQL 的存储压力呢？

### 什么是分库？

**分库** 就是将数据库中的数据分散到不同的数据库上，可以垂直分库，也可以水平分库。

垂直分库（业务划分）、水平分库（一张表分布式存储，一张订单表拆成多张订单表存到不同数据库中）

### 什么是分表？

垂直分表（拆分列成为单独的表）、水平分表（一张表水平拆成多张表）。

水平分表一版和水平分库一起用。

### 什么情况下需要分库分表？

单表的数据达到千万级别以上，数据库读写速度比较缓慢。

数据库中的数据占用的空间越来越大，备份时间越来越长。

应用的并发量太大（应该优先考虑其他性能优化方法，而非分库分表）。

### 常见的分片算法有哪些？

 哈希分片、范围分片、映射表分片、一致性哈希分片、融合算法分片

### 分片键如何选择？

具有共性，即能够覆盖绝大多数的查询场景，离散性，即能够将数据均匀地分散到各个分片上，稳定性，即分片键的值不会发生变化，扩展性，即能够支持分片的动态增加和减少

### 分库分表会带来什么问题呢？

join、事务（分布式事务）、分布式ID、跨库聚合查询问题

### 分库分表有没有什么比较推荐的方案？

Apache ShardingSphere

### 分库分表后，数据怎么迁移呢？

停机更新、双写更新