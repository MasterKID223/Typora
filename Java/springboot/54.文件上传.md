### 文件上传

参考pdf 5.7节，p141。

### MultipartResolver

MultipartFile接收前端传过来的参数。这里用`@Controller`注解，因为要返回视图的html页面，不能只返回数据。

```java
@Controller
public class UploadFileController {

    @PostMapping("/file/upload")
    public String uploadFile(@RequestParam("upfile") MultipartFile multipartFile) {
        Map<String, Object> info = new HashMap<>();
        try {
            if (!multipartFile.isEmpty()) {
                info.put("上传文件参数名", multipartFile.getName());  // 前端的文件参数
                info.put("内容类型", multipartFile.getContentType());

                var ext = "unknown";
                var filename = multipartFile.getOriginalFilename();
                if (filename.indexOf(".") > 0) {
                    ext = filename.substring(filename.indexOf('.'));
                }

                var newFileName = UUID.randomUUID().toString() + ext;
                var path = "F:/code/Java/logs/upload/" + newFileName;
                info.put("上传后文件名称", newFileName);
                multipartFile.transferTo(new File(path));
            }

        } catch (IOException e) {
            e.printStackTrace();
        }
        //  刷新，防止重复上传
        return "redirect:/index.html";
    }
}
```

`index.html`：

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>上传成功</title>
</head>
<body>
  <h1>上传成功</h1>
</body>
</html>	
```

`upload`：

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>上传文件</title>
</head>
<body>
  <h3>上传文件</h3>
  <form action="/file/upload" enctype="multipart/form-data" method="post">
    选择文件：<input type="file" name="upfile" > <br/>
            <input type="submit" value="上传文件">
  </form>
</body>
</html>
```

### 上传文件错误

在`resource/static/error`目录下创建`5xx.html`，上传文件出现500,501,502...错误时会自动显示`5xx.html`页面。

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>上传文件错误</title>
</head>
<body>
  <h3>上传文件错误</h3>
</body>
</html>
```

### 多文件上传

前端页面改成：

```html
<html>
<body>
    <h3>上传文件</h3>
    <form action="files" enctype="multipart/form-data" method="post">
        选择文件 1：<input type="file" name="upfile" > <br/>
        选择文件 2：<input type="file" name="upfile" > <br/>
                   <input type="submit" value="上传文件">
    </form>
</body>
</html>
```

Controller在接收参数时，`MultipartFile file`变成`MultiPartFile[] files`。