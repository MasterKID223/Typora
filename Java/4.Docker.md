## Docker的基本使用

参考：[[csdn](https://blog.csdn.net/qq_38140292/article/details/123256877)]

### 安装

参考菜鸟教程。

 阿里云镜像加速器：[[aliyun](https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors)]

### 部署springboot项目

参考：[[csdn](https://blog.csdn.net/m0_58847451/article/details/129774170)]

好的，这里给一个具体的例子，假设您有一个名为 myapp 的 Spring Boot 应用程序，需要将其运行在 Docker 中。

1. 创建 Dockerfile：在 myapp 项目的根目录下创建一个 Dockerfile 文件，内容如下：

```dockerfile
DockerfileCopy codeFROM openjdk:8-jdk-alpine

COPY target/myapp.jar /app.jar

EXPOSE 8080

ENTRYPOINT ["java", "-jar", "/app.jar"]
```

这个 Dockerfile 使用 openjdk:8-jdk-alpine 作为基础镜像，并将 myapp 项目打包出来的 JAR 文件复制到容器中。容器的 8080 端口也被暴露出来，这是因为 Spring Boot 默认使用的是 8080 端口。最后，使用 ENTRYPOINT 指令设置容器启动时运行的命令。

1. 构建 Docker 镜像：在终端中进入到 myapp 项目的根目录下，然后运行以下命令来构建 Docker 镜像：

```shell
docker build -t myapp .
```

该命令会将 myapp 项目打包并构建出一个名为 myapp 的 Docker 镜像。

1. 运行 Docker 容器：使用以下命令来启动 Docker 容器：

```shell
docker run -p 8080:8080 myapp
```

该命令会启动一个名为 myapp 的容器，并将容器的 8080 端口映射到主机的 8080 端口。这样，您就可以通过浏览器访问 [http://localhost:8080](http://localhost:8080/) 来访问应用程序了。

注意，此示例假定您已经在 myapp 项目中使用 Maven 或 Gradle 打包出了一个可执行的 JAR 文件。如果您还没有打包应用程序，可以在项目的根目录下运行以下命令：

```shell
./mvnw package
```

或者

```shell
./gradlew bootJar
```

这将使用 Maven 或 Gradle 打包出一个可执行的 JAR 文件，然后将其保存到 target 目录下。之后，您就可以使用 Dockerfile 将该 JAR 文件打包成 Docker 镜像并在 Docker 容器中运行了。

==ADD和COPY的区别：==

`COPY` 和 `ADD` 都可以将文件复制到 Docker 镜像中，但它们之间有几个区别：

1. `COPY` 只能复制本地文件或目录，而 `ADD` 还支持从 URL、tar 文件和压缩文件中复制文件到镜像中。
2. `ADD` 在复制文件的同时，还会将其解压缩。因此，如果您需要将文件复制到镜像中并解压缩，可以使用 `ADD` 命令。
3. `ADD` 支持的选项比 `COPY` 更多，例如 `--chown` 选项可以设置文件的所有者和用户组，`--chmod` 选项可以设置文件的权限等。

在 Spring Boot 应用程序的情况下，通常使用 `COPY` 命令将可执行的 JAR 文件复制到镜像中，因为 JAR 文件不需要解压缩。因此，示例 Dockerfile 中使用了 `COPY` 命令：

```bash
COPY target/myapp.jar /app.jar
```

如果您需要复制并解压缩其他类型的文件，可以使用 `ADD` 命令。例如，以下命令将复制并解压缩名为 `myapp.tar.gz` 的文件到镜像中：

```bash
ADD myapp.tar.gz /app
```

### Docker push镜像

可能出现的问题：denied: requested access to the resource is denied.

解决：[[csdn](https://blog.csdn.net/qq_14997473/article/details/110917351)]

`docker tag` 命令用于给一个本地镜像打上一个指定的标签，以便将其推送到远程镜像仓库。它的基本语法如下：

```bash
docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]
```

其中：

- `SOURCE_IMAGE[:TAG]`：要打标签的本地镜像的名称或 ID。可以包含可选的标签，例如 `my-image:latest`。
- `TARGET_IMAGE[:TAG]`：新标签的名称或 ID，用于标识已标记的镜像的位置。同样，可以包含可选的标签。

例如，要将名为 `my-image` 的本地镜像打上标签 `my-registry.com/my-image:v1` 并将其推送到远程镜像仓库，您可以执行以下命令：

```bash
docker tag my-image:latest my-registry.com/my-image:v1
```

这将为本地镜像 `my-image` 创建一个名为 `my-registry.com/my-image` 的新标签，版本号为 `v1`。接下来，您可以使用 `docker push` 命令将其推送到远程镜像仓库：

```bash
docker push my-registry.com/my-image:v1
```

注意，要成功推送标记的镜像，您必须先登录到远程镜像仓库，并具有相应的访问权限。

