### Eureka注册中心

默认端口号是8761，在`application.yml`中这样设置：

```yaml
server:
	port: 8761 #为什么是 8761，eureka默认端口
spring:
	application:
		name: eureka-server #服务名
```

在启动类上添加注解：`@EnableEurekaServer`，开启eureka服务。

启动服务成功之后，访问http://localhost:8761/，出现如下页面：

<img src="./pic/image-20230701194402334.png" alt="image-20230701194402334" style="zoom: 50%;" />

### Eureka集群

<img src="./pic/image-20230701205544275.png" alt="image-20230701205544275" style="zoom:50%;" />

上图中的集群中，有三个server主机，如果一个客户端注册到任意其中一台上，其他服务主机，都会把该客户端注册到自己的服务列表上。这样就保证了服务的高可用性。

首先把本地的hosts文件添加如下两行：

```
127.0.0.1 peer1
127.0.0.1 peer2
```

现在注册两个服务器：

`server-a`

```yaml
server:
  port: 8761
spring:
  application:
    name: eureka-server-a  # peer1

eureka:
  client:
    service-url:
      defaultZone: http://peer2:8762/eureka
  instance:
    hostname: peer1
    instance-id: ${eureka.instance.hostname}:${spring.application.name}:${server.port}
    prefer-ip-address: true  # 用于指定 Eureka 服务注册时是否优先使用 IP 地址而不是主机名来标识服务实例。
    lease-renewal-interval-in-seconds: 5
```

在 Spring Cloud Eureka 中，`prefer-ip-address` 是一种配置选项，用于指定 Eureka 服务注册时是否优先使用 IP 地址而不是主机名来标识服务实例。

当服务实例注册到 Eureka 服务器时，Eureka 会自动获取该实例的主机名（hostname）和 IP 地址。通常情况下，Eureka 会将主机名作为服务实例的标识符。然而，如果设置了 `prefer-ip-address: true`，Eureka 将会优先使用 IP 地址来标识服务实例。

<hr>

使用 IP 地址而不是主机名来标识服务实例有一些潜在的好处：

1. **避免 DNS 解析延迟**：使用 IP 地址直接访问服务实例可以避免 DNS 解析的延迟，从而更快地建立连接。

2. **避免 DNS 变更影响**：如果服务实例所在的主机名发生变化，使用 IP 地址可以避免由于 DNS 变更而导致的服务不可用问题。

3. **解决 DNS 回环问题**：在某些网络环境下，由于 DNS 配置不正确，可能会出现 DNS 回环的问题，使用 IP 地址可以规避这类问题。

要配置 `prefer-ip-address`，可以在 Spring Cloud Eureka 的 `application.yml` 文件中添加如下配置：

```yaml
eureka:
  instance:
    prefer-ip-address: true
```

或者在 `application.properties` 文件中添加：

```
eureka.instance.prefer-ip-address=true
```

请注意，将 `prefer-ip-address` 设置为 `true` 并不是必需的，通常情况下，默认值为 `false`，即使用主机名来标识服务实例。是否使用 IP 地址取决于您的特定场景和需求。

<hr>

`server-b`

```yaml
server:
  port: 8762
spring:
  application:
    name: eureka-server-b  # peer1

eureka:
  client:
    service-url:
      defaultZone: http://peer1:8761/eureka
  instance:
    hostname: peer2
    instance-id: ${eureka.instance.hostname}:${spring.application.name}:${server.port}
    prefer-ip-address: true
    lease-renewal-interval-in-seconds: 5
```

在客户端中，绑定到任一两个中一个，就可以把服务注册到两个注册中心上。

`client-a`

```yaml
server:
  port: 8080  # 客户端端口
spring:
  application:
    name: eureka-client-a
eureka:
  client:
    service-url:
      defaultZone: http://peer1:8761/eureka
  instance:
    hostname: client-a
    instance-id: ${eureka.instance.hostname}:${spring.application.name}:${server.port}
    prefer-ip-address: true
    lease-renewal-interval-in-seconds: 5
```

peer1服务器的注册信息：

<img src="./pic/image-20230701212058038.png" alt="image-20230701212058038" style="zoom: 33%;" />

peer2服务器的注册信息：

<img src="./pic/image-20230701212117979.png" alt="image-20230701212117979" style="zoom:33%;" />

### Eureka的功能

服务的注册、服务的续约（心跳机制）、服务的下线（主动下线）、服务的剔除（被动下线，主动剔除）

### 源码分析

参考动力节点的pdf教程（01Eureka教程）。