## Redis-HMDP

### 什么是NoSQL

sql是关系型数据库。

nosql是非关系型数据库。

### Redis基本操作

RDF连接虚拟机里的Redis：https://blog.csdn.net/qq_39535807/article/details/106449156

### Redis的java客户端

https://redis.io/docs/latest/develop/connect/clients/java/

<img src="./pic/image-20240411105513517.png" alt="image-20240411105513517" style="zoom:50%;" />

Jedis是线程不安全的。使用Jedis连接池进行优化。



### StringRedisTemplate

为什么要使用StringRedisTemplate？

在RedisTemplate set对象时，会自动触发序列化（默认JDK自带的序列化）把对象，但是JDK默认的序列化方案会把字符串转换成字节流（OutputStream），会出现乱码，所以要重写序列化逻辑，直接把字符串写入redis，避免转换成字节流后再写入redis出现乱码。Redis中key一般是一个字符串，所以直接用string序列化，value一般是对象，所以使用json序列化。

<img src="./pic/image-20240411112608993.png" alt="image-20240411112608993" style="zoom:50%;" />

Json序列化器会额外写入@class（对象的字节码）：

<img src="./pic/image-20240411113542744.png" alt="image-20240411113542744" style="zoom:50%;" />

手动实现Json序列化器：

<img src="./pic/image-20240411113609946.png" alt="image-20240411113609946" style="zoom:50%;" />

<img src="./pic/image-20240411113734848.png" alt="image-20240411113734848" style="zoom:50%;" />

在value中对象的json序列化和反序列化完全在后端逻辑中自己实现，这样可以节省空间（没有@class字节码）。

### Redis在项目中的各种应用

Redis中的各种数据结构和应用场景。

<img src="./pic/image-20240411164634531.png" alt="image-20240411164634531" style="zoom:50%;" />

### 基于session短信登陆

<img src="./pic/image-20240411165336473.png" alt="image-20240411165336473" style="zoom:50%;" />

这里重点关注第三步：检验登陆状态中的“保存用户到ThreadLocal”中。

每一个进入tomcat的请求都是一个线程对象，这样ThreadLocal就会在对应的线程空间开辟空间保存对应的用户信息。

### TreadLocal

略。

### Session共享

用Redis代替tomcat中存储的session。

<img src="./pic/image-20240411174947099.png" alt="image-20240411174947099" style="zoom:50%;" />

### Redis实现共享session登陆

<img src="./pic/image-20240411175722368.png" alt="image-20240411175722368" style="zoom:50%;" />

验证码还有多长时间过期：redis中的key过期时间。

用户访问一次，redis中的token的过期时间就更新。

###  登陆拦截器的优化

<img src="./pic/image-20240413234048491.png" alt="image-20240413234048491" style="zoom:50%;" />

### 商户查询缓存

