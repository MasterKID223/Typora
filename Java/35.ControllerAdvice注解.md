## 异常处理

### ControllerAdvice注解

`@ControllerAdvice` 是一个Spring框架中的注解，用于定义全局控制器通知（Controller Advice）。它允许您在整个应用程序中集中管理和处理异常、错误以及其他全局操作，通常与 `@ExceptionHandler`、`@InitBinder` 和 `@ModelAttribute` 注解一起使用。主要用途包括全局异常处理和全局数据绑定。

以下是 `@ControllerAdvice` 注解的一些主要用途和示例：

1. **全局异常处理**：

   使用 `@ControllerAdvice` 注解，您可以创建一个类，其中包含一个或多个 `@ExceptionHandler` 方法，用于捕获和处理在控制器中抛出的异常。这使得在整个应用程序中一致地处理异常成为可能。

   ```java
   @ControllerAdvice
   public class GlobalExceptionHandler {
   
       @ExceptionHandler(Exception.class)
       public ModelAndView handleException(Exception ex) {
           ModelAndView modelAndView = new ModelAndView("error");
           modelAndView.addObject("errorMessage", ex.getMessage());
           return modelAndView;
       }
   }
   ```

2. **全局数据绑定**：

   使用 `@ControllerAdvice` 注解，您还可以定义一个或多个 `@InitBinder` 方法，用于全局配置数据绑定规则。这在处理表单数据验证和数据绑定时非常有用。

   ```java
   @ControllerAdvice
   public class GlobalDataBinder {
   
       @InitBinder
       public void initBinder(WebDataBinder binder) {
           SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");
           dateFormat.setLenient(false);
           binder.registerCustomEditor(Date.class, new CustomDateEditor(dateFormat, false));
       }
   }
   ```

3. **全局模型属性**：

   您还可以使用 `@ControllerAdvice` 定义 `@ModelAttribute` 方法，将全局的模型属性添加到所有控制器的模型中。这可以用于在每个请求中添加共享的数据。

   ```java
   @ControllerAdvice
   public class GlobalModelAttributes {
   
       @ModelAttribute("appVersion")
       public String getAppVersion() {
           return "1.0.0";
       }
   }
   ```

总之，`@ControllerAdvice` 注解用于创建全局控制器通知，允许您在整个应用程序中集中处理异常、配置数据绑定规则以及添加全局模型属性。这有助于提高应用程序的可维护性和一致性。

### ExceptionHandler注解

`@ExceptionHandler` 是Spring框架中的注解，用于在控制器（Controller）类中定义异常处理方法。它允许您指定特定类型的异常，并为这些异常提供自定义处理逻辑。当控制器中的代码抛出被 `@ExceptionHandler` 标注的异常时，Spring框架会调用相应的异常处理方法来处理异常。

以下是使用 `@ExceptionHandler` 注解的基本示例：

```java
@Controller
public class MyController {

    @ExceptionHandler(Exception.class)
    public ModelAndView handleException(Exception ex) {
        ModelAndView modelAndView = new ModelAndView("error");
        modelAndView.addObject("errorMessage", ex.getMessage());
        return modelAndView;
    }
}
```

在上面的示例中：

- `@ExceptionHandler(Exception.class)` 指定了要处理的异常类型，这里是 `Exception` 类型的异常。
- `handleException` 方法是异常处理方法，它会处理抛出的 `Exception` 类型的异常。
- 方法内部可以根据需要执行自定义的处理逻辑，然后返回一个 `ModelAndView` 对象，该对象通常包含了要渲染的错误页面以及与页面相关的数据。

您可以根据需要定义多个 `@ExceptionHandler` 方法，以处理不同类型的异常。Spring将根据异常类型选择调用适当的异常处理方法。

需要注意的是，`@ExceptionHandler` 方法通常被定义在控制器类中，用于处理该控制器中的方法抛出的异常。您还可以使用 `@ControllerAdvice` 注解来创建全局异常处理器，处理整个应用程序中的异常。在全局异常处理器中，您可以定义多个 `@ExceptionHandler` 方法，用于处理不同类型的异常。

总之，`@ExceptionHandler` 注解允许您为控制器中的特定异常定义自定义的异常处理方法，以便更好地管理和处理异常情况。这有助于提高应用程序的可靠性和用户友好性。