一、时序知识图谱创建

1. 创建时序知识图谱

   从本地选择日志文件并解析成四元组，将解析的四元组和其他信息保存到数据库。

   - 请求参数

     | 参数名  | 类型 | 必需 | 说明                 |
     | ------- | ---- | ---- | -------------------- |
     | logFile | File | 是   | 日志文件，从本地上传 |

   - 返回响应

     ```json
     {
         "data": {
             "quadruples": [["苏-27 利佩茨克 #4", "发现新目标", "导弹#50306", "2022/11/04 03:02:14"], ["AIM-120D型先进中程空空导弹 P3I.4 #12800", "脱靶", "苏-57 布琼 #3", "2022/11/04 03:02:16"], ["苏-57 布琼 #3", "失败干扰", "AIM-120D型先进中程空空导弹 P3I.4 #12800", "2022/11/04 03:02:16"]]
         },
         "quadruplesNumber": 15649,
         "entityNumber": 1777,
         "relationNumber", 19,
         "startTime": "2022/11/03 21:42:46",
         "endTime": "2022/11/04 3:45:46",
         "recordNumber": 16546,
         "resolvedRecordNumber": 14238,
         "unresolvedRecordNumber": 2308,
         "unresolvedRecord": [["2022/11/4 2:06:17:A-50 kipelovo #1: 私有目标 VAMPIRE #35490 已丢失."], ["2022/11/4 2:06:16:苏-57 Besovets #2: 私有目标 导弹#35469 已丢失."], ["2022/11/4 2:06:15:更新目标: VAMPIRE #30720数据, 新信息源：: 苏-35 Besovets #2"]]
     }
     ```

​			注：其中四元组的返回格式根据前端使用的组件库的渲染格式需求进行调整。

2. 手动添加四元组

   对日志中未解析的记录或者遗漏的记录进行手动添加，同时需要插入到数据库中。

   - 请求参数

     | 参数名       | 类型   | 必需 | 说明                       |
     | ------------ | ------ | ---- | -------------------------- |
     | headEntity   | String | 是   | 四元组头实体               |
     | relationship | String | 是   | 四元组的头尾实体之间的关系 |
     | tailEntity   | String | 是   | 四元组尾实体               |
     | time         | String | 是   | 四元组的时间戳             |

   - 返回响应

     ```json
     {
         "isSuccess": true
     }
     ```

二、时序知识图谱查看

1. 选择想定

   - 请求参数

   | 参数名       | 类型   | 必需 | 说明                                                     |
   | ------------ | ------ | ---- | -------------------------------------------------------- |
   | scenarioName | String | 是   | 想定名称，根据想定名称找到对应的数据库，返回对应的数据。 |

   - 返回响应

     ```json
     {
         "quadruples": [["苏-27 利佩茨克 #4", "发现新目标", "导弹#50306", "2022/11/04 03:02:14"], ["AIM-120D型先进中程空空导弹 P3I.4 #12800", "脱靶", "苏-57 布琼 #3", "2022/11/04 03:02:16"], ["苏-57 布琼 #3", "失败干扰", "AIM-120D型先进中程空空导弹 P3I.4 #12800", "2022/11/04 03:02:16"]]
         },
         "quadruplesNumber": 15649,
         "entityNumber": 1777,
         "relationNumber", 19,
         "startTime": "2022/11/03 21:42:46",
         "endTime": "2022/11/04 3:45:46"
     }
     ```

     注：其中四元组的返回格式根据前端使用的组件库的渲染格式需求进行调整。

2. 按类别展示图谱

   - 请求参数

     | 参数名      | 类型     | 必需 | 说明                   |
     | ----------- | -------- | ---- | ---------------------- |
     | entityClass | String[] | 是   | 选择的要展示的实体类别 |

   - 返回响应

     含有对应类别的实体的四元组。

     ```json
     {
         "quadruples": [["苏-27 利佩茨克 #4", "发现新目标", "导弹#50306", "2022/11/04 03:02:14"], ["AIM-120D型先进中程空空导弹 P3I.4 #12800", "脱靶", "苏-57 布琼 #3", "2022/11/04 03:02:16"], ["苏-57 布琼 #3", "失败干扰", "AIM-120D型先进中程空空导弹 P3I.4 #12800", "2022/11/04 03:02:16"]]
     }
     ```

3. 按关系类别展示图谱

   - 请求参数

     | 参数名        | 类型     | 必需 | 说明                   |
     | ------------- | -------- | ---- | ---------------------- |
     | relationships | String[] | 是   | 选择的要展示的关系类型 |

   - 返回响应

     返回含有特定关系类型的四元组。

     ```json
     {
         "quadruples": [["苏-27 利佩茨克 #4", "发现新目标", "导弹#50306", "2022/11/04 03:02:14"], ["苏-57 布琼 #3", "发现新目标", "AIM-120D型先进中程空空导弹 P3I.4 #12800", "2022/11/04 03:02:16"], ["苏-57 布琼 #5", "发现新目标", "AIM-120D型先进中程空空导弹 P3I.4 #12800", "2022/11/04 03:02:16"]]
     }
     ```

三、时序知识图谱推理

1. 根据时间点展示知识图谱

   - 请求参数

     | 参数名 | 类型   | 必需 | 说明                         |
     | ------ | ------ | ---- | ---------------------------- |
     | time   | String | 是   | 在时间轴上选择的具体的时间刻 |

   - 返回响应

     ```json
     {
         "time": "2022/11/04 03:02:14",
         "quadruples": [
         {
             "n": {
                 "label": "芬兰_CFacility",
                 "name": "雷达 (KEVA 2010型防空雷达 [GM 403型“地面大师”3D防空雷达])"
             },
             "r": {
                 "type": "发现新目标",
                 "startNode": {
                     "label": "芬兰_CFacility",
                     "name": "雷达 (KEVA 2010型防空雷达 [GM 403型“地面大师”3D防空雷达])"
                 },
                 "endNode": {
                     "label": "美国_CAircraft",
                     "name": "U-2S RAF Mildenhall #2"
                 },
                 "created_at": "2022-11-03T16:44:17Z"
             },
             "m": {
                 "label": "美国_CAircraft",
                 "name": "U-2S RAF Mildenhall #2"
             }
         },
             ...
     ]
     }
     ```

2. 根据时间段展示知识图谱

   - 请求参数

     | 参数名    | 类型   | 必需 | 说明                         |
     | --------- | ------ | ---- | ---------------------------- |
     | startTime | String | 是   | 在时间轴上选择的开始的时间刻 |
     | endTime   | String | 是   | 在时间轴上选择的结束的时间刻 |

   - 返回响应

     ```json
     {
         "startTime": "2022/11/04 03:02:14",
         "endTime": "2022/11/04 04:17:34",
         "quadruples": [
         {
             "n": {
                 "label": "芬兰_CFacility",
                 "name": "雷达 (KEVA 2010型防空雷达 [GM 403型“地面大师”3D防空雷达])"
             },
             "r": {
                 "type": "发现新目标",
                 "startNode": {
                     "label": "芬兰_CFacility",
                     "name": "雷达 (KEVA 2010型防空雷达 [GM 403型“地面大师”3D防空雷达])"
                 },
                 "endNode": {
                     "label": "美国_CAircraft",
                     "name": "U-2S RAF Mildenhall #2"
                 },
                 "created_at": "2022-11-03T16:44:17Z"
             },
             "m": {
                 "label": "美国_CAircraft",
                 "name": "U-2S RAF Mildenhall #2"
             }
         },
             ...
     ]
     }
     ```

3. 返回选中的实体的对应历史事件

   - 请求参数

     | 参数名 | 类型   | 必需 | 说明       |
     | ------ | ------ | ---- | ---------- |
     | entity | String | 是   | 选中的实体 |

   - 返回响应

     ```json
     {
         "history": [{
             "head": "USS DDG 72 “马汉号”阿里伯克级 Flight II驱逐舰 #2",
             "relationship": "发射",
             "tail": "RGM-109E 战术战斧 Blk IV 巡航导弹 #11480",
             "time": "2022/11/03 06:12:34"},
         ...]
     }
     ```

4. 预测

   - 请求参数

     | 参数名       | 类型   | 必需 | 说明       |
     | ------------ | ------ | ---- | ---------- |
     | headEntity   | String | 是   | 选中的实体 |
     | relationship | String | 是   | 预测关系   |
     | time         | String | 是   | 时间       |

   - 返回响应

     ```json
     {
         "0": {
             "194": 0.8384338021278381,
             "433": 0.8191553950309753,
             "1158": 0.7302285730838776,
             "43": 0.3827294111251831,
             "120": 0.3827294111251831,
             "922": 0.3827294111251831,
             "1278": 0.3827294111251831,
             "472": 0.20567423105239868,
             "82": 0.20567423105239868,
             "1542": 0.20567423105239868,
             "209": 0.20265352725982666,
             "219": 0.11712074279785156,
             "259": 0.10709577798843384,
             "1671": 0.10709577798843384,
             "650": 0.10709577798843384,
             "1039": 0.10709577798843384,
             "284": 0.10709577798843384,
             "1699": 0.10709577798843384,
             "172": 0.10709577798843384,
             "181": 0.10709577798843384,
             "1472": 0.10709577798843384,
             "846": 0.10709577798843384,
             "852": 0.10709577798843384,
             "475": 0.10709577798843384,
             "609": 0.10709577798843384,
             "1251": 0.10709577798843384,
             "358": 0.10709577798843384,
             "359": 0.10709577798843384,
             "1768": 0.10709577798843384,
             "234": 0.10709577798843384,
             "1012": 0.10709577798843384,
             "1273": 0.10709577798843384
         },
     }
     ```

     注：key 均为实体的对应id可以根据需要换成实体名字，value 为预测的概率分数。