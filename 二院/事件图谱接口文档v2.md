## 一、时序知识图谱创建

每个事件的格式是这样的（"雷达 (KEVA 2010型防空雷达 [GM 403型“地面大师”3D防空雷达])@发现新目标@U-2S侦察机@2022/11/03 16:44:17@0"），直接把这个字符串显示在一个节点上。

### 1. 创建事件知识图谱

从本地选择日志文件并解析成事件链，将解析的事件链和其他信息保存到数据库。

- 请求参数

  | 参数名  | 类型 | 必需 | 说明                 |
  | ------- | ---- | ---- | -------------------- |
  | logFile | File | 是   | 日志文件，从本地上传 |

- 返回响应

  ```json
  {
      "data": {
          "eventData": [
              ["雷达 (KEVA 2010型防空雷达 [GM 403型“地面大师”3D防空雷达])","发现新目标","U-2S侦察机","2022/11/03 16:44:17","0"], ["U-2S侦察机","离开","单实体机场 (4x 4000m+ 跑道)","2022/11/03 21:25:29","0"],
         		["F-22A“猛禽”战斗机","发现新目标","SA-26 [9M96D]","2022/11/04 02:55:31","1"], ["SA-26 [9M96D]","命中","F-22A“猛禽”战斗机","2022/11/04 02:56:41","1"],
              ["F-15 2040C型“攻击鹰”战斗机","完成出动准备","单实体机场 (4x 4000m+ 跑道)","2022/11/03 21:40:36","2"]
          ]
      },
      "eventNumber": 5211,
      "afterLinkedNumber": 3999,
      "singleEventNumber": 1942,
      "eventLinkNumber": 2057,
      "startTime": "2022/11/03 21:42:46",
      "endTime": "2022/11/04 3:45:46",
      "sceneName": "scene1"
  }
  ```
  
- 参数解释

  （显示的时候需要把@1，即事件链的唯一索引展示在节点上，方便后续添加事件节点和预测操作）

  `eventData`：是一个二维数组，二维数组中的每一个元素都是一个字符串数组，字符串数组（事件链）中每一条是一个事件。每个事件中的@0、@1、@2......表示事件链的唯一标识，用来识别事件属于哪条链。

  `eventNumber`：事件的总数量。

  `afterLinkedNumber` ：事件经过事件链抽取之后事件链的个数，即eventData数组的长度。

  `singleEventNumber`：事件链中只有一个事件的链的数量，如eventData中的最后一条链。

  `eventLinkNumber`：事件链中事件个数大于1的链的数量。

### 2. 手动添加事件

对日志中没有连接到事件链中的事件进行手动添加，同时需要插入到数据库中。

- 请求参数

  | 参数名       | 类型   | 必需 | 说明                       |
  | ------------ | ------ | ---- | -------------------------- |
  | headEntity   | String | 是   | 四元组头实体               |
  | relationship | String | 是   | 四元组的头尾实体之间的关系 |
  | tailEntity   | String | 是   | 四元组尾实体               |
  | time         | String | 是   | 四元组的时间戳             |
  | linkIndex    | String | 是   | 事件链唯一的索引           |

- 参数解释

  `linkIndex`：事件最后的@字符后的索引（@0，@1......），用来识别当前事件属于哪条链。

- 返回响应

  ```json
  {
      "isSuccess": true
  }
  ```

## 二、事件知识图谱查看

### 1. 选择想定

- 请求参数

    | 参数名       | 类型   | 说明                                                     | 必需 |
    | ------------ | ------ | -------------------------------------------------------- | ---- |
    | scenarioName | String | 想定名称，根据想定名称找到对应的数据库，返回对应的数据。 | 是   |

- 返回响应

  ```json
  {
      "data":{
           "eventData": [
               ["雷达 (KEVA 2010型防空雷达 [GM 403型“地面大师”3D防空雷达])","发现新目标","U-2S侦察机","2022/11/03 16:44:17","0"], ["U-2S侦察机","离开","单实体机场 (4x 4000m+ 跑道)","2022/11/03 21:25:29","0"],
         		["F-22A“猛禽”战斗机","发现新目标","SA-26 [9M96D]","2022/11/04 02:55:31","1"], ["SA-26 [9M96D]","命中","F-22A“猛禽”战斗机","2022/11/04 02:56:41","1"],
              ["F-15 2040C型“攻击鹰”战斗机","完成出动准备","单实体机场 (4x 4000m+ 跑道)","2022/11/03 21:40:36","2"]
     	 ],
      }
      "afterLinkedNumber": 3999,
      "startTime": "2022/11/03 21:42:46",
      "endTime": "2022/11/04 3:45:46",
  }
  ```

## 三、事件知识图谱推理

### 1. 根据时间段展示知识图谱

- 请求参数

  | 参数名    | 类型   | 必需 | 说明                         |
  | --------- | ------ | ---- | ---------------------------- |
  | startTime | String | 是   | 在时间轴上选择的开始的时间刻 |
  | endTime   | String | 是   | 在时间轴上选择的结束的时间刻 |

- 返回响应

  ```json
  {
      "startTime": "2022/11/04 03:02:14",
      "endTime": "2022/11/04 04:17:34",
      "data":{
           "eventData": [
               ["雷达 (KEVA 2010型防空雷达 [GM 403型“地面大师”3D防空雷达])","发现新目标","U-2S侦察机","2022/11/03 16:44:17","0"], ["U-2S侦察机","离开","单实体机场 (4x 4000m+ 跑道)","2022/11/03 21:25:29","0"],
         		["F-22A“猛禽”战斗机","发现新目标","SA-26 [9M96D]","2022/11/04 02:55:31","1"], ["SA-26 [9M96D]","命中","F-22A“猛禽”战斗机","2022/11/04 02:56:41","1"],
              ["F-15 2040C型“攻击鹰”战斗机","完成出动准备","单实体机场 (4x 4000m+ 跑道)","2022/11/03 21:40:36","2"]
     	 ],
      }
  }
  ```
  
- 参数解释

  在显示的时候，把事件固定显示在它对应的时间窗口。

### 2. 返回选中的事件的对应事件链

- 请求参数

  | 参数名 | 类型   | 必需 | 说明           |
  | ------ | ------ | ---- | -------------- |
  | event  | String | 是   | 选中的事件节点 |

- 返回响应

  ```json
  {
   "data":{
           "eventData": [
               ["雷达 (KEVA 2010型防空雷达 [GM 403型“地面大师”3D防空雷达])","发现新目标","U-2S侦察机","2022/11/03 16:44:17","0"], ["U-2S侦察机","离开","单实体机场 (4x 4000m+ 跑道)","2022/11/03 21:25:29","0"],
         		["F-22A“猛禽”战斗机","发现新目标","SA-26 [9M96D]","2022/11/04 02:55:31","1"], ["SA-26 [9M96D]","命中","F-22A“猛禽”战斗机","2022/11/04 02:56:41","1"],
              ["F-15 2040C型“攻击鹰”战斗机","完成出动准备","单实体机场 (4x 4000m+ 跑道)","2022/11/03 21:40:36","2"]
     	 ],
      }
  }
  ```

- 参数解释

  `event`：即图中的事件节点，格式是（字符串）："F-22A“猛禽”战斗机@发现新目标@SA-26 [9M96D]@2022/11/04 02:55:31@1"。

### 3. 预测

- 请求参数

  | 参数名 | 类型   | 必需 | 说明                                                     |
  | ------ | ------ | ---- | -------------------------------------------------------- |
  | event  | String | 是   | 选中的事件，根据选中事件的唯一事件链索引，发送整条事件链 |

- 返回响应

  （返回的是20个事件发生的可能性）
  
  ```json
  {
      "0": {
          "194": 0.8384338021278381,
          "433": 0.8191553950309753,
          "1158": 0.7302285730838776,
          "43": 0.3827294111251831,
          "120": 0.3827294111251831,
          "922": 0.3827294111251831,
          "1278": 0.3827294111251831,
          "472": 0.20567423105239868,
          "82": 0.20567423105239868,
          "1542": 0.20567423105239868,
          "209": 0.20265352725982666,
          "219": 0.11712074279785156,
          "259": 0.10709577798843384,
          "1671": 0.10709577798843384,
          "650": 0.10709577798843384,
          "1039": 0.10709577798843384,
          "284": 0.10709577798843384,
          "1699": 0.10709577798843384,
          "172": 0.10709577798843384,
          "181": 0.10709577798843384,
      },
  }
  ```
  
  注：key 均为实体的对应id可以根据需要换成实体名字，value 为预测的概率分数。





```json
{
    "0": {
        "射手空空导弹@目标是@战斧巡航导弹III@596": 0.8384,
        "射手空空导弹@目标是@战术战斧IV 巡航导弹@596": 0.8191,
        "射手空空导弹@脱靶@战斧巡航导弹III@596": 0.7302,
        "射手空空导弹@脱靶@战术战斧IV 巡航导弹@596": 0.3827,
        ...
    },
}

```

